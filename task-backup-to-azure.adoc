---
sidebar: sidebar
permalink: task-backup-to-azure.html
keywords: backing up, back up, backup, backup cloud volumes ontap, back up cloud volumes ontap, cloud volumes ontap, azure, azure blob, back up volumes, cloud backup
summary: Complete a few steps to get started backing up volume data from your Cloud Volumes ONTAP systems to Azure Blob storage.
---

= Backing up Cloud Volumes ONTAP data to Azure Blob storage
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./media/

[.lead]
Complete a few steps to get started backing up volume data from your Cloud Volumes ONTAP systems to Azure Blob storage.

== Quick start

Get started quickly by following these steps or scroll down to the remaining sections for full details.

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-1.png[One] Verify support for your configuration

[role="quick-margin-list"]
* You're running Cloud Volumes ONTAP 9.7P5 or later in Azure (ONTAP 9.8P13 and later is recommended).
* You have a valid cloud provider subscription for the storage space where your backups will be located.
* You have subscribed to the https://azuremarketplace.microsoft.com/en-us/marketplace/apps/netapp.cloud-manager?tab=Overview[BlueXP Marketplace Backup offering^], or you have purchased link:task-licensing-cloud-backup.html#use-a-bluexp-backup-and-recovery-byol-license[and activated^] a BlueXP backup and recovery BYOL license from NetApp.
* You have a Connector installed in Azure. The Connector can be installed in a site with full internet access ("standard mode"), with limited internet connectivity ("restricted mode") or without internet access ("private mode").

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-2.png[Two] Enable BlueXP backup and recovery on your new or existing system

[role="quick-margin-list"]
* New systems: BlueXP backup and recovery is enabled by default in the working environment wizard. Be sure to keep the option enabled.

* Existing systems: Select the working environment and click *Enable* next to the Backup and recovery service in the right-panel, and then follow the setup wizard.
+
image:screenshot_backup_cvo_enable.png[A screenshot that shows the BlueXP backup and recovery Enable button which is available after you select a working environment.]

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-3.png[Three] Enter the provider details

[role="quick-margin-para"]
Select the provider subscription and region, and choose whether you want to create a new resource group or use an already existing resource group. You can also choose your own customer-managed keys for data encryption instead of using the default Microsoft-managed encryption key.

[role="quick-margin-para"]
image:screenshot_backup_provider_settings_azure.png[A screenshot that shows the cloud provider details when backing up volumes from a Cloud Volumes ONTAP system to an Azure Blob tier.]

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-4.png[Four] Define the default backup policy

[role="quick-margin-para"]
The default policy backs up volumes every day and retains the most recent 30 backup copies of each volume. Change to hourly, daily, weekly, monthly, or yearly backups, or select one of the system-defined policies that provide more options. You can also change the number of backup copies you want to retain.

[role="quick-margin-para"]
Optionally, when using ONTAP 9.12.1 and greater, you can choose to protect your backups from deletion and ransomware attacks by configuring one of the _DataLock and Ransomware Protection_ settings. link:concept-cloud-backup-policies.html[Learn more about the available BlueXP backup and recovery policy configuration settings^].

[role="quick-margin-para"]
Backups are stored in the Cool access tier by default. If your cluster is using ONTAP 9.10.1 or greater, you can choose to tier backups to Azure Archive storage after a certain number of days for further cost optimization. link:concept-cloud-backup-policies.html[Learn more about the available BlueXP backup and recovery policy configuration settings^].

[role="quick-margin-para"]
image:screenshot_backup_policy_azure.png[A screenshot that shows the BlueXP backup and recovery settings where you can select the backup policy and choose your backup retention.]

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-5.png[Five] Select the volumes that you want to back up

[role="quick-margin-para"]
Identify which volumes you want to back up using the default backup policy in the Select Volumes page. If you want to assign different backup policies to certain volumes, you can create additional policies and apply them to volumes later.

== Requirements

Read the following requirements to make sure that you have a supported configuration before you start backing up volumes to Azure Blob storage.

The following image shows each component and the connections that you need to prepare between them:

image:diagram_cloud_backup_cvo_azure.png[A diagram showing how BlueXP backup and recovery communicates with the volumes on the source systems and the destination storage where the backup files are located.]

Supported ONTAP versions::
Minimum of ONTAP 9.7P5; ONTAP 9.8P13 and later is recommended.

License requirements::
For BlueXP backup and recovery PAYGO licensing, a subscription through the Azure Marketplace is required before you enable BlueXP backup and recovery. Billing for BlueXP backup and recovery is done through this subscription. https://docs.netapp.com/us-en/cloud-manager-cloud-volumes-ontap/task-deploying-otc-azure.html[You can subscribe from the Details & Credentials page of the working environment wizard^].
+
For BlueXP backup and recovery BYOL licensing, you need the serial number from NetApp that enables you to use the service for the duration and capacity of the license. link:task-licensing-cloud-backup.html#use-a-bluexp-backup-and-recovery-byol-license[Learn how to manage your BYOL licenses]. You must use a BYOL license when the Connector and Cloud Volumes ONTAP system are deployed in a dark site ("private mode").
+
And you need to have a Microsoft Azure subscription for the storage space where your backups will be located.

Connector requirements::
The Connector can be installed in an Azure region with full or limited internet access ("standard" or "restricted" mode), or in a site with no internet access ("private" mode). https://docs.netapp.com/us-en/cloud-manager-setup-admin/concept-modes.html[See BlueXP deployment modes for details^].

* https://docs.netapp.com/us-en/cloud-manager-setup-admin/concept-connectors.html[Learn about Connectors^]
* https://docs.netapp.com/us-en/cloud-manager-setup-admin/task-quick-start-connector-azure.html[Deploy a Connector in Azure in standard mode (full internet access)^]
* https://docs.netapp.com/us-en/cloud-manager-setup-admin/task-quick-start-restricted-mode.html[Install the Connector in restricted mode (limited outbound access)^]
* https://docs.netapp.com/us-en/cloud-manager-setup-admin/task-quick-start-private-mode.html[Install the Connector in private mode (no internet access)^]

[NOTE]
====
BlueXP backup and recovery functionality is built into the BlueXP Connector. When installed in private mode, you'll need to update the Connector software periodically to get access to new features. Check the link:whats-new.html[BlueXP backup and recovery What's new] to see the new features in each BlueXP backup and recovery release, and then you can follow the steps to https://docs.netapp.com/us-en/cloud-manager-setup-admin/task-managing-connectors.html#upgrade-the-connector-when-using-private-mode[upgrade the Connector software^] when you want to use new features.

We highly recommend that you create local backups of the internal BlueXP backup and recovery configuration data periodically when the Connector is installed in a site without internet connectivity. link:reference-backup-cbs-db-in-dark-site.html[See how to back up BlueXP backup and recovery data in a dark site^].
====

Verify or add permissions to the Connector::

To use the BlueXP backup and recovery Search & Restore functionality, you need to have specific permissions in the role for the Connector so that it can access the Azure Synapse Workspace and Data Lake Storage Account. See the permissions below, and follow the steps if you need to modify the policy.
+
.Before you start
+
* You must register the Azure Synapse Analytics Resource Provider (called "Microsoft.Synapse") with your Subscription. https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/resource-providers-and-types#register-resource-provider[See how to register this resource provider for your subscription^]. You must be the Subscription *Owner* or *Contributor* to register the resource provider.
* Port 1433 must be open for communication between the Connector and the Azure Synapse SQL services.
+
.Steps

. Identify the role assigned to the Connector virtual machine:

.. In the Azure portal, open the Virtual machines service.

.. Select the Connector virtual machine.

.. Under Settings, select *Identity*.

.. Click *Azure role assignments*.

.. Make note of the custom role assigned to the Connector virtual machine.

. Update the custom role:

.. In the Azure portal, open your Azure subscription.

.. Click *Access control (IAM) > Roles*.

.. Click the ellipsis (...) for the custom role and then click *Edit*.

.. Click JSON and add the following permissions:
+
[source,json]
"Microsoft.Compute/virtualMachines/read",
"Microsoft.Compute/virtualMachines/start/action",
"Microsoft.Compute/virtualMachines/deallocate/action",
"Microsoft.Storage/storageAccounts/listkeys/action",
"Microsoft.Storage/storageAccounts/read",
"Microsoft.Storage/storageAccounts/write",
"Microsoft.Storage/storageAccounts/blobServices/containers/read",
"Microsoft.Storage/storageAccounts/listAccountSas/action",
"Microsoft.KeyVault/vaults/read",
"Microsoft.KeyVault/vaults/accessPolicies/write",
"Microsoft.Network/networkInterfaces/read",
"Microsoft.Resources/subscriptions/locations/read",
"Microsoft.Network/virtualNetworks/read",
"Microsoft.Network/virtualNetworks/subnets/read",
"Microsoft.Resources/subscriptions/resourceGroups/read",
"Microsoft.Resources/subscriptions/resourcegroups/resources/read",
"Microsoft.Resources/subscriptions/resourceGroups/write",
"Microsoft.Authorization/locks/*",
"Microsoft.Network/privateEndpoints/write",
"Microsoft.Network/privateEndpoints/read",
"Microsoft.Network/privateDnsZones/virtualNetworkLinks/write",
"Microsoft.Network/virtualNetworks/join/action",
"Microsoft.Network/privateDnsZones/A/write",
"Microsoft.Network/privateDnsZones/read",
"Microsoft.Network/privateDnsZones/virtualNetworkLinks/read",
"Microsoft.Compute/virtualMachines/extensions/delete",
"Microsoft.Compute/virtualMachines/delete",
"Microsoft.Network/networkInterfaces/delete",
"Microsoft.Network/networkSecurityGroups/delete",
"Microsoft.Resources/deployments/delete",
"Microsoft.Network/publicIPAddresses/delete",
"Microsoft.Storage/storageAccounts/blobServices/containers/write",
"Microsoft.ManagedIdentity/userAssignedIdentities/assign/action",
"Microsoft.Synapse/workspaces/write",
"Microsoft.Synapse/workspaces/read",
"Microsoft.Synapse/workspaces/delete",
"Microsoft.Synapse/register/action",
"Microsoft.Synapse/checkNameAvailability/action",
"Microsoft.Synapse/workspaces/operationStatuses/read",
"Microsoft.Synapse/workspaces/firewallRules/read",
"Microsoft.Synapse/workspaces/replaceAllIpFirewallRules/action",
"Microsoft.Synapse/workspaces/operationResults/read",
"Microsoft.Synapse/workspaces/privateEndpointConnectionsApproval/action"
+
https://docs.netapp.com/us-en/cloud-manager-setup-admin/reference-permissions-azure.html[View the full JSON format for the policy^]

.. Click *Review + update* and then click *Update*.

Supported Azure regions::
BlueXP backup and recovery is supported in all Azure regions https://cloud.netapp.com/cloud-volumes-global-regions[where Cloud Volumes ONTAP is supported^]; including Azure Government regions. It is also supported in https://learn.microsoft.com/en-us/azure/compliance/offerings/offering-dod-il6[Azure IL6 secure regions^].

By default, BlueXP backup and recovery provisions the Blob container with Local redundancy (LRS) for cost optimization. You can change this setting to Zone redundancy (ZRS) after BlueXP backup and recovery has been activated if you want to make sure your data is replicated between different zones. See the Microsoft instructions for https://learn.microsoft.com/en-us/azure/storage/common/redundancy-migration?tabs=portal[changing how your storage account is replicated^].

Required setup for creating backups in a different Azure subscription::
By default, backups are created using the same subscription as the one used for your Cloud Volumes ONTAP system. If you want to use a different Azure subscription for your backups, you must link:reference-backup-multi-account-azure.html[log in to the Azure portal and link the two subscriptions].

Required information for using customer-managed keys for data encryption::
You can use your own customer-managed keys for data encryption in the activation wizard instead of using the default Microsoft-managed encryption keys. In this case you will need to have the Azure Subscription, Key Vault name, and the Key. https://docs.microsoft.com/en-us/azure/storage/common/customer-managed-keys-overview[See how to use your own keys^].

== Enabling BlueXP backup and recovery on a new system

BlueXP backup and recovery is enabled by default in the working environment wizard. Be sure to keep the option enabled.

See https://docs.netapp.com/us-en/cloud-manager-cloud-volumes-ontap/task-deploying-otc-azure.html[Launching Cloud Volumes ONTAP in Azure^] for requirements and details for creating your Cloud Volumes ONTAP system.

NOTE: If you want to pick the name of the resource group, *disable* BlueXP backup and recovery when deploying Cloud Volumes ONTAP. Follow the steps for <<enabling-bluexp-backup-and-recovery-on-an-existing-system,enabling BlueXP backup and recovery on an existing system>> to enable BlueXP backup and recovery and choose the resource group.

.Steps

. Click *Create Cloud Volumes ONTAP*.

. Select Microsoft Azure as the cloud provider and then choose a single node or HA system.

. In the Define Azure Credentials page, enter the credentials name, client ID, client secret, and directory ID, and click *Continue*.

. Fill out the Details & Credentials page and be sure that an Azure Marketplace subscription is in place, and click *Continue*.

. On the Services page, leave the service enabled and click *Continue*.
+
image:screenshot_backup_to_gcp.png[Shows the BlueXP backup and recovery option in the working environment wizard.]

. Complete the pages in the wizard to deploy the system.

.Result

BlueXP backup and recovery is enabled on the system and backs up volumes every day and retains the most recent 30 backup copies.

== Enabling BlueXP backup and recovery on an existing system

Enable BlueXP backup and recovery at any time directly from the working environment.

.Steps

. Select the working environment and click *Enable* next to the Backup and recovery service in the right-panel.
+
If the Azure Blob destination for your backups exists as a working environment on the Canvas, you can drag the cluster onto the Azure Blob working environment to initiate the setup wizard.
+
image:screenshot_backup_cvo_enable.png[A screenshot that shows the BlueXP backup and recovery Enable button which is available after you select a working environment.]

. Select the provider details and click *Next*.

.. The Azure subscription used to store the backups. This can be a different subscription than where the Cloud Volumes ONTAP system resides.
+
If you want to use a different Azure subscription for your backups, you must link:reference-backup-multi-account-azure.html[log in to the Azure portal and link the two subscriptions].
.. The region where the backups will be stored. This can be a different region than where the Cloud Volumes ONTAP system resides.
.. The resource group that manages the Blob container - you can create a new resource group or select an existing resource group.
.. Whether you'll use the default Microsoft-managed encryption key or choose your own customer-managed keys to manage encryption of your data. (https://docs.microsoft.com/en-us/azure/storage/common/customer-managed-keys-overview[See how to use your own keys]).
+
image:screenshot_backup_provider_settings_azure.png[A screenshot that shows the cloud provider details when backing up volumes from a Cloud Volumes ONTAP system to an Azure Blob tier.]

. Enter the backup policy details that will be used for your default policy and click *Next*. You can select an existing policy, or you can create a new policy by entering your selections in each section:

.. Enter the name for the default policy. You don't need to change the name.
.. Define the backup schedule and choose the number of backups to retain. link:concept-ontap-backup-to-cloud.html#customizable-backup-schedule-and-retention-settings[See the list of existing policies you can choose^].
.. Optionally, when using ONTAP 9.12.1 and greater, you can choose to protect your backups from deletion and ransomware attacks by configuring one of the _DataLock and Ransomware Protection_ settings. _DataLock_ protects your backup files from being modified or deleted, and _Ransomware protection_ scans your backup files to look for evidence of a ransomware attack in your backup files. link:concept-cloud-backup-policies.html#datalock-and-ransomware-protection[Learn more about the available DataLock settings^].
.. When using ONTAP 9.10.1 and greater, you can choose to tier backups to Azure Archive storage after a certain number of days for further cost optimization. This feature is not available when deployed in dark sites. link:reference-azure-backup-tiers.html[Learn more about using archival tiers].
+
image:screenshot_backup_policy_azure.png[A screenshot that shows the BlueXP backup and recovery settings where you can choose your schedule and backup retention.]

. Select the volumes that you want to back up using the defined backup policy in the Select Volumes page. If you want to assign different backup policies to certain volumes, you can create additional policies and apply them to those volumes later.

+
* To back up all existing volumes and any volumes added in the future, check the box "Back up all existing and future volumes...". We recommend this option so that all your volumes will be backed up and you'll never have to remember to enable backups for new volumes.
* To back up only existing volumes, check the box in the title row (image:button_backup_all_volumes.png[""]).
* To back up individual volumes, check the box for each volume (image:button_backup_1_volume.png[""]).
+
image:screenshot_backup_select_volumes.png[A screenshot of selecting the volumes that will be backed up.]

+
* If there are any local Snapshot copies for read/write volumes in this working environment that match the backup schedule label you just selected for this working environment (for example, daily, weekly, etc.), an additional prompt is displayed "Export existing Snapshot copies to object storage as backup copies". Check this box if you want all historic Snapshots to be copied to object storage as backup files to ensure the most complete protection for your volumes.

. Click *Activate Backup* and BlueXP backup and recovery starts taking the initial backups of each selected volume.

.Result

A Blob storage container is created automatically in the resource group you entered, and the backup files are stored there. 

The Volume Backup Dashboard is displayed so you can monitor the state of the backups. You can also monitor the status of backup and restore jobs using the link:task-monitor-backup-jobs.html[Job Monitoring panel^].

By default, BlueXP backup and recovery provisions the Blob container with Local redundancy (LRS) for cost optimization. You can change this setting to Zone redundancy (ZRS) if you want to make sure your data is replicated between different zones. See the Microsoft instructions for https://learn.microsoft.com/en-us/azure/storage/common/redundancy-migration?tabs=portal[changing how your storage account is replicated^].

== What's next?

* You can link:task-manage-backups-ontap.html[manage your backup files and backup policies^]. This includes starting and stopping backups, deleting backups, adding and changing the backup schedule, and more.
* You can link:task-manage-backup-settings-ontap.html[manage cluster-level backup settings^]. This includes changing the network bandwidth available to upload backups to object storage, changing the automatic backup setting for future volumes, and more.
* You can also link:task-restore-backups-ontap.html[restore volumes, folders, or individual files from a backup file^] to a Cloud Volumes ONTAP system in Azure, or to an on-premises ONTAP system.
