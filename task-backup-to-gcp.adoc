---
sidebar: sidebar
permalink: task-backup-to-gcp.html
keywords: backing up, back up, backup, backup cloud volumes ontap, back up cloud volumes ontap, cloud volumes ontap, gcp, google cloud, back up volumes, cloud backup
summary: Complete a few steps to get started backing up volume data from your Cloud Volumes ONTAP systems to Google Cloud storage.
---

= Backing up Cloud Volumes ONTAP data to Google Cloud Storage
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./media/

[.lead]
Complete a few steps to get started backing up volume data from your Cloud Volumes ONTAP systems to Google Cloud Storage.

== Quick start

Get started quickly by following these steps or scroll down to the remaining sections for full details.

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-1.png[One] Verify support for your configuration

[role="quick-margin-list"]
* You're running Cloud Volumes ONTAP 9.7P5 or later in GCP (ONTAP 9.8P13 and later is recommended).
* You have a valid GCP subscription for the storage space where your backups will be located.
* You have a service account in your Google Cloud Project that has the predefined Storage Admin role.
* You have subscribed to the https://console.cloud.google.com/marketplace/details/netapp-cloudmanager/cloud-manager?supportedpurview=project&rif_reserved[BlueXP Marketplace Backup offering^], or you have purchased link:task-licensing-cloud-backup.html#use-a-bluexp-backup-and-recovery-byol-license[and activated^] a BlueXP backup and recovery BYOL license from NetApp.
* You have a Connector installed in Google Cloud.

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-2.png[Two] Enable BlueXP backup and recovery on your new or existing system

[role="quick-margin-list"]
* New systems: BlueXP backup and recovery can be enabled when you complete the new working environment wizard.

* Existing systems: Select the working environment and click *Enable* next to the Backup and recovery service in the right-panel, and then follow the setup wizard.
+
image:screenshot_backup_cvo_enable.png[A screenshot that shows the BlueXP backup and recovery Enable button which is available after you select a working environment.]

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-3.png[Three] Enter the provider details

[role="quick-margin-para"]
Select the Google Cloud Project and region where you want the Google Cloud Storage bucket to be created for backups. You can also choose your own customer-managed keys for data encryption instead of using the default Google-managed encryption key.

[role="quick-margin-para"]
image:screenshot_backup_provider_settings_gcp.png[A screenshot that shows the cloud provider details when backing up volumes from a Cloud Volumes ONTAP system installed on GCP to a Google Cloud Storage bucket.]

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-4.png[Four] Define the default backup policy

[role="quick-margin-para"]
The default policy backs up volumes every day and retains the most recent 30 backup copies of each volume. Change to hourly, daily, weekly, monthly, or yearly backups, or select one of the system-defined policies that provide more options. You can also change the number of backup copies you want to retain.

[role="quick-margin-para"]
Backups are stored in Standard storage by default. If your cluster is using ONTAP 9.12.1 or greater, you can choose to tier backups to Archive storage after a certain number of days for further cost optimization. link:concept-cloud-backup-policies.html[Learn more about the available BlueXP backup and recovery policy configuration settings^].

[role="quick-margin-para"]
image:screenshot_backup_policy_gcp.png[A screenshot that shows the BlueXP backup and recovery settings where you can enable or disable the feature and then choose your backup retention.]

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-5.png[Five] Select the volumes that you want to back up

[role="quick-margin-para"]
Identify which volumes you want to back up using the default backup policy in the Select Volumes page. If you want to assign different backup policies to certain volumes, you can create additional policies and apply them to volumes later.

== Requirements

Read the following requirements to make sure that you have a supported configuration before you start backing up volumes to Google Cloud storage.

The following image shows each component and the connections that you need to prepare between them:

image:diagram_cloud_backup_cvo_google.png[A diagram showing how BlueXP backup and recovery communicates with the volumes on the source system and the destination storage where the backup files are located.]

Supported ONTAP versions::
Minimum of ONTAP 9.7P5; ONTAP 9.8P13 and later is recommended.

License requirements::
For BlueXP backup and recovery PAYGO licensing, a BlueXP subscription is available in the Google Marketplace that enables deployments of Cloud Volumes ONTAP and BlueXP backup and recovery. You need to https://console.cloud.google.com/marketplace/details/netapp-cloudmanager/cloud-manager?supportedpurview=project[subscribe to this BlueXP subscription^] before you enable BlueXP backup and recovery. Billing for BlueXP backup and recovery is done through this subscription. https://docs.netapp.com/us-en/bluexp-cloud-volumes-ontap/task-deploying-gcp.html[You can subscribe from the Details & Credentials page of the working environment wizard^].
+
For BlueXP backup and recovery BYOL licensing, you need the serial number from NetApp that enables you to use the service for the duration and capacity of the license. link:task-licensing-cloud-backup.html#use-a-bluexp-backup-and-recovery-byol-license[Learn how to manage your BYOL licenses^].
+
And you need to have a Google subscription for the storage space where your backups will be located.

Supported GCP regions::
BlueXP backup and recovery is supported in all GCP regions https://cloud.netapp.com/cloud-volumes-global-regions[where Cloud Volumes ONTAP is supported^].

GCP Service Account::
You need to have a service account in your Google Cloud Project that has the predefined Storage Admin role. https://docs.netapp.com/us-en/bluexp-cloud-volumes-ontap/task-creating-gcp-service-account.html[Learn how to create a service account^].

Connector requirements::
The Connector must be installed in an Google region with internet access.

* https://docs.netapp.com/us-en/bluexp-setup-admin/concept-connectors.html[Learn about Connectors^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/task-quick-start-connector-google.html[Deploy a Connector in Google Cloud^]

Verify or add permissions to the Connector::

To use the BlueXP backup and recovery "Search & Restore" functionality, you need to have specific permissions in the role for the Connector so that it can access the Google Cloud BigQuery service. See the permissions below, and follow the steps if you need to modify the policy.

. In https://console.cloud.google.com[Cloud Console^], go to the *Roles* page.

. Using the drop-down list at the top of the page, select the project or organization that contains the role that you want to edit.

. Click a custom role.

. Click *Edit Role* to update the role's permissions.

. Click *Add Permissions* to add the following new permissions to the role.
+
[source,json]
bigquery.jobs.get
bigquery.jobs.list
bigquery.jobs.listAll
bigquery.datasets.create
bigquery.datasets.get
bigquery.jobs.create
bigquery.tables.get
bigquery.tables.getData
bigquery.tables.list
bigquery.tables.create

. Click *Update* to save the edited role.

Required information for using customer-managed encryption keys (CMEK)::
You can use your own customer-managed keys for data encryption instead of using the default Google-managed encryption keys. Both cross-region and cross-project keys are supported, so you can choose a project for a bucket that is different than the project of the CMEK key. If you're planning to use your own customer-managed keys: 
+
* You'll need to have the Key Ring and the Key Name so you can add this information in the activation wizard. https://cloud.google.com/kms/docs/cmek[Learn more about customer-managed encryption keys^].
+
* You'll need to verify that these required permissions are included in the role for the Connector:
+
[source,json]
cloudkms.cryptoKeys.get
cloudkms.cryptoKeys.getIamPolicy
cloudkms.cryptoKeys.list
cloudkms.cryptoKeys.setIamPolicy
cloudkms.keyRings.get
cloudkms.keyRings.getIamPolicy
cloudkms.keyRings.list
cloudkms.keyRings.setIamPolicy
+
* You'll need to verify that the Google "Cloud Key Management Service (KMS)" API is enabled in your project. See the https://cloud.google.com/apis/docs/getting-started#enabling_apis[Google Cloud documentation: Enabling APIs] for details.
+
* *CMEK considerations:*
+
** Both HSM (Hardware-backed) and Software-generated keys are supported.
** Both newly created or imported Cloud KMS keys are supported.
** Only regional keys are supported, global keys are not supported.
** Currently, only the "Symmetric encrypt/decrypt" purpose is supported.
** The service agent associated with the Storage Account is assigned the "CryptoKey Encrypter/Decrypter (roles/cloudkms.cryptoKeyEncrypterDecrypter)" IAM role by BlueXP backup and recovery. 

== Enabling BlueXP backup and recovery on a new system

BlueXP backup and recovery can be enabled when you complete the working environment wizard to create a new Cloud Volumes ONTAP system.

You must have a Service Account already configured. If you don't select a service account when you create the Cloud Volumes ONTAP system, then you'll need to turn off the system and add the service account to Cloud Volumes ONTAP from the GCP console.

See https://docs.netapp.com/us-en/bluexp-cloud-volumes-ontap/task-deploying-gcp.html[Launching Cloud Volumes ONTAP in GCP^] for requirements and details for creating your Cloud Volumes ONTAP system.

.Steps

. On the Working Environments page, click *Add Working Environment* and follow the prompts.

. *Choose a Location*: Select *Google Cloud Platform*.

. *Choose Type*: Select *Cloud Volumes ONTAP* (either single-node or high-availability).

. *Details & Credentials*: Enter the following information:
.. Click *Edit Project* and select a new project if the one you want to use is different than the default Project (where the Connector resides).
.. Specify the cluster name.
.. Enable the *Service Account* switch and select the Service Account that has the predefined Storage Admin role. This is required to enable backups and tiering.
.. Specify the credentials.
+
Make sure that a GCP Marketplace subscription is in place.
+
image:screenshot_backup_to_gcp_new_env.png[Screenshot that shows how to enable a Service Account in the working environment wizard.]

. *Services*: Leave the BlueXP backup and recovery service enabled and click *Continue*.
+
image:screenshot_backup_to_gcp.png[Shows the BlueXP backup and recovery option in the working environment wizard.]

. Complete the pages in the wizard to deploy the system as described in https://docs.netapp.com/us-en/bluexp-cloud-volumes-ontap/task-deploying-gcp.html[Launching Cloud Volumes ONTAP in GCP^].

.Result

BlueXP backup and recovery is enabled on the system and backs up the volume you created every day and retains the most recent 30 backup copies.

== Enabling BlueXP backup and recovery on an existing system

You can enable BlueXP backup and recovery at any time directly from the working environment.

.Steps

. Select the working environment and click *Enable* next to the Backup and recovery service in the right-panel.
+
If the Google Cloud Storage destination for your backups exists as a working environment on the Canvas, you can drag the cluster onto the Google Cloud Storage working environment to initiate the setup wizard.
+
image:screenshot_backup_cvo_enable.png[A screenshot that shows the BlueXP backup and recovery Settings button which is available after you select a working environment.]

. Select the provider details and click *Next*.

.. The Google Cloud Project and region where you want the Google Cloud Storage bucket to be created for backups.
// This can be a different Project and region than where the Cloud Volumes ONTAP system resides.
.. Whether you'll use the default Google-managed encryption key or choose your own customer-managed keys to manage encryption of your data. To use a CMEK, you'll need to have the Key Ring and the Key Name. https://cloud.google.com/kms/docs/cmek[Learn more about customer-managed encryption keys^].
+
image:screenshot_backup_provider_settings_gcp.png[A screenshot that shows the cloud provider details when backing up volumes from a Cloud Volumes ONTAP system installed on GCP to a Google Cloud Storage bucket.]
+
Note that the Project must have a Service Account that has the predefined Storage Admin role.

. Enter the backup policy details that will be used for your default policy and click *Next*. You can select an existing policy, or you can create a new policy by entering your selections in each section:

.. Enter the name for the default policy. You don't need to change the name.
.. Define the backup schedule and choose the number of backups to retain. link:concept-ontap-backup-to-cloud.html#customizable-backup-schedule-and-retention-settings[See the list of existing policies you can choose^].
.. When using ONTAP 9.12.1 or greater, you can choose to tier backups to Archive storage after a certain number of days for further cost optimization. link:concept-cloud-backup-policies.html[Learn more about the available BlueXP backup and recovery policy configuration settings^].
+
image:screenshot_backup_policy_gcp.png[A screenshot that shows the BlueXP backup and recovery settings where you can enable or disable the feature and then choose your backup retention.]

. Select the volumes that you want to back up using the defined backup policy in the Select Volumes page. If you want to assign different backup policies to certain volumes, you can create additional policies and apply them to those volumes later.

+
* To back up all existing volumes and any volumes added in the future, check the box "Back up all existing and future volumes...". We recommend this option so that all your volumes will be backed up and you'll never have to remember to enable backups for new volumes.
* To back up only existing volumes, check the box in the title row (image:button_backup_all_volumes.png[]).
* To back up individual volumes, check the box for each volume (image:button_backup_1_volume.png[]).
+
image:screenshot_backup_select_volumes.png[A screenshot of selecting the volumes that will be backed up.]

+
* If there are any local Snapshot copies for read/write volumes in this working environment that match the backup schedule label you just selected for this working environment (for example, daily, weekly, etc.), an additional prompt is displayed "Export existing Snapshot copies to object storage as backup copies". Check this box if you want all historic Snapshots to be copied to object storage as backup files to ensure the most complete protection for your volumes.

. Click *Activate Backup* and BlueXP backup and recovery starts taking the initial backups of each selected volume.

.Result

A Google Cloud Storage bucket is created automatically in the service account indicated by the Google access key and secret key you entered, and the backup files are stored there. The Volume Backup Dashboard is displayed so you can monitor the state of the backups. You can also monitor the status of backup and restore jobs using the link:task-monitor-backup-jobs.html[Job Monitoring panel^].

Backups are associated with the _Standard_ storage class by default. You can use the lower cost _Nearline_, _Coldline_, or _Archive_ storage classes. However, you configure the storage class through Google, not through the BlueXP backup and recovery UI. See the Google topic https://cloud.google.com/storage/docs/changing-default-storage-class[Changing the default storage class of a bucket^] for details.

== What's next?

* You can link:task-manage-backups-ontap.html[manage your backup files and backup policies^]. This includes starting and stopping backups, deleting backups, adding and changing the backup schedule, and more.
* You can link:task-manage-backup-settings-ontap.html[manage cluster-level backup settings^]. This includes changing the network bandwidth available to upload backups to object storage, changing the automatic backup setting for future volumes, and more.
* You can also link:task-restore-backups-ontap.html[restore volumes, folders, or individual files from a backup file^] to a Cloud Volumes ONTAP system in Google, or to an on-premises ONTAP system.
