---
sidebar: sidebar
permalink: task-deploy-snapcenter-plugin-for-sap-hana.html
keywords: Cloud Manager, BlueXP, SnapCenter Plug-in for SAP HANA, SAP HANA, database, host, deploy
summary:  Deploy the SnapCenter Plug-in for SAP HANA on each of the SAP HANA database hosts.
---

= Deploy SnapCenter Plug-in for SAP HANA and add database hosts 
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./media/

[.lead]
You should deploy the SnapCenter Plug-in for SAP HANA on each of the SAP HANA database hosts. Depending on whether the SAP HANA host has an SSH key based authentication enabled, you can follow one of the methods to deploy the plug-in.

== Prerequisites

* Ensure that either Java 11 (64-bit) Oracle Java or OpenJDK is installed on each of the SAP HANA database hosts.
* You should have added the working environment and created the Connector.
* Ensure that the Connector has connectivity to the working environment 
* Ensure that the BlueXP user has the “Account Admin” role.
* You should have created the SnapCenter user and configured sudo for the SnapCenter user. For information, refer to link:task-deploy-snapcenter-plugin-for-sap-hana.html#configure-sudo-for-snapcenter-user[Configure sudo for SnapCenter user.]
* You should have deployed the SnapCenter Plug-in for SAP HANA before adding the database host. 
* While adding the SAP HANA database hosts, you should add the HDB user store keys. The HDB secure user store key is used to store the connection information of SAP HANA database hosts securely on the client and HDBSQL client uses the secure user store key to connect to SAP HANA database host.  
* For HANA System Replication (HSR), to protect the HANA systems, you should manually register both primary and secondary HANA systems.
* Connector should have the communication enabled to the SSH port (default: 22) if SSH based deployment is used.
* Connector should have communication enabled to plug-in port (default: 8145) for the operations to work.

== Configure sudo for SnapCenter user

You should create a SnapCenter user to deploy the plug-in.

*Steps*

. Log into the Connector VM.
. Download the Linux host plug-in binary.
`sudo docker exec -it cloudmanager_scs_cloud curl -X GET 'http://127.0.0.1/deploy/downloadLinuxPlugin'`
. Obtain the base mount path.
`sudo docker volume ls | grep scs_cloud_volume | awk {'print $2'} | xargs sudo docker volume inspect | grep Mountpoint`
. Copy lines 1 to 16 from the `oracle_checksum_scs.txt` file located at `base_mount_path/version/sc-linux-host-plugin/`
. Log into the SAP HANA database host and perform the following steps:
.. Create the SnapCenter user account, private key pair, and assign the permissions.
.. Paste the lines that you copied in step 4 to the `/etc/sudoers` file by using the visudo Linux utility.
+
In the above lines, replace the <LINUXUSER> with the SnapCenter user that you created and save in the visuod utility.

== Deploy the plug-in using SSH key based authentication

If SSH key based authentication is enabled on the HANA host, you can perform the following steps to deploy the plug-in. Before performing the steps, ensure that the SSH connection to the Connector is enabled.

*Steps*

. Log into the Connector VM.

. Obtain the base mount path.
`# sudo docker volume ls | grep scs_cloud_volume | awk {'print $2'} | xargs sudo docker volume inspect | grep Mountpoint`

. Deploy the plug-in.
`# sudo <base_mount_path>/scripts/hana_plugin_copy_and_install.sh --host <host_name> --sshkey <ssh_key_file> --username <user_name> --port <ssh_port> --pluginport <plugin_port> --installdir <install_dir>`

* host_name is the name of the HANA host, and this is a mandatory parameter.
* ssh_key_file is the SSH key used to connect to the HANA host, and this is a mandatory parameter.
* user_name: User with SSH privileges on the HANA host, and this is an optional parameter. Default value is azureuser.
* ssh_port: SSH port on the HANA host, and this is an optional parameter. Default value is 22.
* plugin_port: Port used by the plug-in, and this is an optional parameter. Default value is 8145.
* install_dir: Directory where the plug-in will be deployed, and this is an optional parameter. Default value is /opt.

After deploying the plug-in, you should add the link:task-deploy-snapcenter-plugin-for-sap-hana.html#add-sap-hana-database-hosts[SAP HANA database hosts.]

== Deploy the plug-in manually

If SSH key based authentication is not enabled on the HANA host, you should perform the following manual steps to deploy the plug-in.

*Steps*

. Log into the Connector VM.

. Download the Linux host plug-in binary.
`# sudo docker exec -it cloudmanager_scs_cloud curl -X GET 'http://127.0.0.1/deploy/downloadLinuxPlugin'`

. Obtain the base mount path.
`sudo docker volume ls | grep scs_cloud_volume | awk {'print $2'} | xargs sudo docker volume inspect | grep Mountpoint`

. Obtain the binary path of the downloaded plug-in.
`sudo ls <base_mount_path> $(sudo docker ps|grep -Po "cloudmanager_scs_cloud:.*? "|sed -e 's/ *$//'|cut -f2 -d":")/sc-linux-host-plugin/snapcenter_linux_host_plugin_scs.bin`

. Copy `snapcenter_linux_host_plugin_scs.bin` to each of the SAP HANA database hosts either using scp or other alternate methods.

. On the SAP HANA database host, run the following command to enable execute permissions for the binary.
`chmod +x snapcenter_linux_host_plugin_scs.bin`

. Deploy the SAP HANA plug-in as a sudo SnapCenter user.
`./snapcenter_linux_host_plugin_scs.bin -i silent -DSPL_USER=<non-root-user>`

. Copy `certificate.p12` from `<base_mount_path>/client/certificate/` path of the Connector VM to `/var/opt/snapcenter/spl/etc/` on the plug-in host.

.. Navigate to `/var/opt/snapcenter/spl/etc` and execute the keytool command to import the certificate.
`keytool -v -importkeystore -srckeystore certificate.p12 -srcstoretype PKCS12 -destkeystore keystore.jks -deststoretype JKS -srcstorepass snapcenter -deststorepass snapcenter -srcalias agentcert -destalias agentcert -noprompt`
.. Restart SPL: `systemctl restart spl`

. Validate that the plug-in is reachable from the Connector by running the below command from the Connector:
+
`docker exec -it cloudmanager_scs_cloud curl -ik \https://<FQDN or IP of the plug-in host>:<plug-in port>/getVersion --cert /config/client/certificate/certificate.pem --key /config/client/certificate/key.pem`

== Add SAP HANA database hosts

You should manually add SAP HANA database hosts to assign policies and create backups. Auto discovery of SAP HANA database host is not supported.

*Steps*

.	In the *BlueXP* UI, click *Protection* > *Backup and recovery* > *Applications*.
.	Click *Discover Applications*.
.	Select *Cloud Native* > *SAP HANA* and click *Next*.
.	In the *Applications* page, click *Add System*.  
.	In the *System Details* page, perform the following actions:
..	Select the System Type as Multi-tenant database container or Single Container.
..	Enter the SAP HANA system name.
..	Specify the SID of the SAP HANA system.
..	(Optional) Specify HDBSQL OS user.
..	Select Plug-in host.  
(Optional) If the host is not added or if you want to add multiple hosts, click *Add Plug-in Host*.
..	If HANA system is configured with HANA System replication, enable *HANA System Replication (HSR) System*.
..	Click *HDB Secure User Store Keys* text box to add user store keys details.
+
Specify the key name, system details, username, and password and click *Add Key*.
+
You can delete or modify the user store keys.
.   Click *Next*.
.	In the *Storage Footprint* page, click *Add Storage* and perform the following:
..	Select the working environment and specify the NetApp account.
+
Go to *Canvas* page to add a new working environment
..	Select the required volumes.
..	Click *Add Storage*.
.	Review all the details and click *Add System*.

NOTE: The filter to view a specific host does not work. When you specify a host name in the filter, all the hosts are displayed

You can modify and remove the SAP HANA systems using REST API. Before removing the HANA system, you should delete all the associated backups and remove protection.

=== Add Non-Data Volumes
After adding the multitenant database container or single container type SAP HANA system, you can add the Non-Data Volumes of the HANA system.

*Steps*

.   In the *BlueXP* UI, click *Protection* > *Backup and recovery* > *Applications*.
.	Click *Discover Applications*.
.	Select *Cloud Native* > *SAP HANA* and click *Next*.
.	In the *Applications* page, click image:icon-action.png[icon to select the action] corresponding to the system for which you want to add the Non-Data Volumes and select *Manage System* > *Non-Data Volume*.

=== Add  Global Non-Data Volumes
After adding the multitenant database container or single container type SAP HANA system, you can add the Global Non-Data Volumes of the HANA system.

*Steps*

.	In the *BlueXP* UI, click *Protection* > *Backup and recovery* > *Applications*.
.	Click *Discover Applications*.
.	Select *Cloud Native* > *SAP HANA* and click *Next*.
.	In the *Applications* page, click *Add System*.
.	In the *System Details* page, perform the following actions:
..	From System Type drop-down, select *Global Non-Data Volume*.
..	Enter the SAP HANA system name.
..	Specify the associated SIDs of the SAP HANA system.
..	Select the plug-in host
+
(Optional) To add multiple hosts, click on *Add Plug-in Host* and specify the host name and port and click *Add Host*.
..	Click *Next*.
..	Review all the details and click *Add System*.  